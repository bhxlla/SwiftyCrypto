//
//  MarketData.swift
//  SwiftyCrypto
//
//  Created by varunbhalla19 on 07/02/23.
//

import Foundation

// JSON DATA
/*
 https://api.coingecko.com/api/v3/global
 {
   "data": {
     "active_cryptocurrencies": 12362,
     "upcoming_icos": 0,
     "ongoing_icos": 49,
     "ended_icos": 3376,
     "markets": 656,
     "total_market_cap": {
       "btc": 48671714.226679906,
       "eth": 680069697.3894504,
       "ltc": 11329058591.096176,
       "bch": 8374025113.042343,
       "bnb": 3408683624.8750343,
       "eos": 1026852913813.801,
       "xrp": 2833381833145.822,
       "xlm": 12421055292861.127,
       "link": 158675926499.66626,
       "dot": 166431754124.83798,
       "yfi": 145957095.31862357,
       "usd": 1134049059342.1843,
       "aed": 4165305492510.876,
       "ars": 214968316545382.9,
       "aud": 1631954432895.4282,
       "bdt": 120989020053535.84,
       "bhd": 427423090466.0694,
       "bmd": 1134049059342.1843,
       "brl": 5870064740967.011,
       "cad": 1521597850832.723,
       "chf": 1045831383015.9546,
       "clp": 901965919347808.8,
       "cny": 7703255045393.641,
       "czk": 25146991279266.32,
       "dkk": 7867419987224.01,
       "eur": 1057265999681.3016,
       "gbp": 941916199610.3127,
       "hkd": 8900994568006.61,
       "huf": 414285512020025,
       "idr": 17176833422801666,
       "ils": 3945373688187.3516,
       "inr": 93914324553138.92,
       "jpy": 148483651652508.84,
       "krw": 1424576685476612.5,
       "kwd": 346386212783.59576,
       "lkr": 414392371194788.94,
       "mmk": 2380911335655923.5,
       "mxn": 21475497243204.465,
       "myr": 4879813102349.437,
       "ngn": 522138867902327.4,
       "nok": 11741513021786.445,
       "nzd": 1793203734594.2341,
       "php": 62357956760097.8,
       "pkr": 313564564908113.9,
       "pln": 5027112466569.242,
       "rub": 81424722460768.67,
       "sar": 4255158467580.6753,
       "sek": 12016872607934.363,
       "sgd": 1501690753645.0293,
       "thb": 38020709396624.46,
       "try": 21348541585060.184,
       "twd": 34054700551753.324,
       "uah": 41667232806448.68,
       "vef": 113552332311.93298,
       "vnd": 26759068237469572,
       "zar": 19903243688989.082,
       "xdr": 845021913931.0588,
       "xag": 50950181901.93603,
       "xau": 604504851.0823536,
       "bits": 48671714226679.91,
       "sats": 4867171422667991
     },
     "total_volume": {
       "btc": 3046159.8332765065,
       "eth": 42562729.27573779,
       "ltc": 709038581.7994514,
       "bch": 524095346.7017097,
       "bnb": 213335307.9384643,
       "eos": 64266446136.96224,
       "xrp": 177329565428.23026,
       "xlm": 777382106243.5405,
       "link": 9930865215.884754,
       "dot": 10416270157.152752,
       "yfi": 9134846.557296408,
       "usd": 70975406320.0747,
       "aed": 260689118643.31842,
       "ars": 13453971401908.506,
       "aud": 102137229440.30974,
       "bdt": 7572198740280.676,
       "bhd": 26750630642.036167,
       "bmd": 70975406320.0747,
       "brl": 367382898193.9705,
       "cad": 95230470700.4907,
       "chf": 65454229462.43603,
       "clp": 56450289416671.57,
       "cny": 482114642510.37054,
       "czk": 1573845425001.8096,
       "dkk": 492389042329.2642,
       "eur": 66169874484.36132,
       "gbp": 58950611030.515015,
       "hkd": 557076169600.1938,
       "huf": 25928404336579.21,
       "idr": 1075026447429670.4,
       "ils": 246924503218.63486,
       "inr": 5877706338648.921,
       "jpy": 9292973192921.928,
       "krw": 89158320138687.45,
       "kwd": 21678870057.216278,
       "lkr": 25935092207165.953,
       "mmk": 149011321924884.75,
       "mxn": 1344061908261.911,
       "myr": 305407173395.2826,
       "ngn": 32678496577888.727,
       "nok": 734852386383.6531,
       "nzd": 112229151489.55484,
       "php": 3902724738297.3574,
       "pkr": 19624699847500.652,
       "pln": 314626026971.38245,
       "rub": 5096034173781.3545,
       "sar": 266312642036.87054,
       "sek": 752085995767.6357,
       "sgd": 93984568417.94806,
       "thb": 2379557811694.8613,
       "try": 1336116282499.786,
       "twd": 2131341839982.8264,
       "uah": 2607778520962.999,
       "vef": 7106767434.829084,
       "vnd": 1674738606108167.5,
       "zar": 1245661108111.9172,
       "xdr": 52886401339.12161,
       "xag": 3188759633.264228,
       "xau": 37833440.33891597,
       "bits": 3046159833276.5063,
       "sats": 304615983327650.6
     },
     "market_cap_percentage": {
       "btc": 39.62085639759364,
       "eth": 17.755391064437674,
       "usdt": 6.068447929920672,
       "bnb": 4.617486324517587,
       "usdc": 3.6805903492350778,
       "xrp": 1.7978581838700662,
       "busd": 1.4390549989632044,
       "ada": 1.2227761408450954,
       "doge": 1.1251445933807112,
       "matic": 0.9970331879365522
     },
     "market_cap_change_percentage_24h_usd": 1.98849955709656,
     "updated_at": 1675793850
   }
 }
 */

struct GlobalData: Codable {
    let data: MarketData?
}

struct MarketData: Codable {
    let totalMarketCap, totalVolume, marketCapPercentage: [String: Double]
    let marketCapChangePercentage24HUsd: Double
    
    enum CodingKeys: String, CodingKey {
        case totalMarketCap = "total_market_cap"
        case totalVolume = "total_volume"
        case marketCapPercentage = "market_cap_percentage"
        case marketCapChangePercentage24HUsd = "market_cap_change_percentage_24h_usd"
    }
    
    var marketCap: String {
        guard let item = totalMarketCap.first(where: { $0.key == "usd" }) else { return ""}
        return "$\(item.value.formattedWithAbbreviations())"
    }
    
    var volume: String {
        guard let item = totalVolume.first(where: { $0.key == "usd" }) else { return ""}
        return "$\(item.value.formattedWithAbbreviations())"
    }
    
    var btcDominance: String {
        guard let item = marketCapPercentage.first(where: { $0.key == "btc" }) else { return ""}
        return item.value.asPercent
    }
    
}
